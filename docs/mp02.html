<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Salvatore Davi">

<title>Rolling In Green: GTA IV’s Award’s for Eco Transit – STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-824b22946342c3b062afb6f9f3c44d05.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="site_libs/datatables-binding-0.33/datatables.js"></script>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>



<link rel="stylesheet" href="body {
  background-color: #F5F5DC;
}">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#awards" id="toc-awards" class="nav-link active" data-scroll-target="#awards">Awards</a>
  <ul class="collapse">
  <li><a href="#greenest-transit-agency" id="toc-greenest-transit-agency" class="nav-link" data-scroll-target="#greenest-transit-agency">Greenest Transit Agency</a></li>
  <li><a href="#most-emissions-avoiders" id="toc-most-emissions-avoiders" class="nav-link" data-scroll-target="#most-emissions-avoiders">Most Emissions Avoiders</a></li>
  <li><a href="#the-smooth-sailors" id="toc-the-smooth-sailors" class="nav-link" data-scroll-target="#the-smooth-sailors">The Smooth Sailors</a></li>
  <li><a href="#the-earth-destroyers" id="toc-the-earth-destroyers" class="nav-link" data-scroll-target="#the-earth-destroyers">The Earth Destroyers</a></li>
  <li><a href="#conclusion-of-the-awards" id="toc-conclusion-of-the-awards" class="nav-link" data-scroll-target="#conclusion-of-the-awards">Conclusion of the awards</a></li>
  </ul></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">Analysis</a></li>
  <li><a href="#awards-calculations" id="toc-awards-calculations" class="nav-link" data-scroll-target="#awards-calculations">Awards Calculations</a>
  <ul class="collapse">
  <li><a href="#greenest-transit-agency-1" id="toc-greenest-transit-agency-1" class="nav-link" data-scroll-target="#greenest-transit-agency-1">Greenest Transit Agency</a></li>
  <li><a href="#most-emissions-avoiders-1" id="toc-most-emissions-avoiders-1" class="nav-link" data-scroll-target="#most-emissions-avoiders-1">Most Emissions Avoiders</a></li>
  <li><a href="#the-smooth-sailors-1" id="toc-the-smooth-sailors-1" class="nav-link" data-scroll-target="#the-smooth-sailors-1">The Smooth Sailors</a></li>
  <li><a href="#the-earth-destroyers-1" id="toc-the-earth-destroyers-1" class="nav-link" data-scroll-target="#the-earth-destroyers-1">The Earth Destroyers</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Rolling In Green: GTA IV’s Award’s for Eco Transit</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Salvatore Davi </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="awards" class="level1">
<h1>Awards</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="leo-toast.jpg" class="img-fluid figure-img"></p>
<figcaption>Let’s Get Rolling!</figcaption>
</figure>
</div>
<p>As the newly minted Executive Director of the Green Transit Alliance for Investigation of Variance, I’m here to kick off the annual Rolling In Green awards—where sustainability meets a bit of sass! Our mission? To celebrate the transit agencies across the nation that continue to hustle hard for a cleaner, greener planet. So buckle up! Now, let’s shine the spotlight on those agencies who’ve not only gone green but have practically turned sustainability into an art form. Stay tuned for the green revolution on wheels!</p>
<p><strong>The awards are:</strong> <br> 1. Greenest Transit Agency <br> 2. Most Emissions Avoiders <br> 3. Smooth Sailors <br> 4. Earth Destroyers <br></p>
<section id="greenest-transit-agency" class="level2">
<h2 class="anchored" data-anchor-id="greenest-transit-agency">Greenest Transit Agency</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="green_award.jpg" class="img-fluid figure-img"></p>
<figcaption>The water tastes fresh on this side</figcaption>
</figure>
</div>
<p>This award goes to the agency that is always fighting for our planet, the one that strives to streamline its workflow and push relentlessly toward sustainability. We honor the trailblazers who not only embrace green practices but also innovate to reduce their environmental impact. Their continuous effort to optimize operations and lower emissions sets a shining example for the transit industry, proving that eco-friendly progress is not only possible but essential for our future.</p>
<p><strong>Small-Sized Transit Agency:</strong> <br> Agency - Hampton Jitney, Inc <br> State - New York <br> Green Score - 0.4 <br> Emissions Per Mile - 0.12 CO₂ emissions</p>
<p><strong>Medium-sized Transit Agency:</strong> <br> Agency - City of Seattle, dba: Seattle Center Monorail <br> State - Washington <br> Green Score - 0.07 <br> Emissions Per Mile - 0.077 CO₂ emissions <br></p>
<p><strong>Large-sized Transit Agency:</strong> <br> Agency - Tri-County Metropolitan Transportation District of Oregon, dba: TriMet <br> State - Oregon <br> Green Score - 0.2 <br> Emissions Per Mile - 0.124 CO₂ emissions<br></p>
<p>This award was determined by carefully analyzing the emissions performance of each agency. We computed the CO₂ emissions per UPT (Unlinked Passenger Trip) and per mile, providing a comprehensive view of their environmental impact. To ensure a fair comparison, we calculated a green score by taking the harmonic mean of these two emissions metrics. This method highlights agencies that consistently excel in reducing emissions both on a per-trip and per-mile basis, ultimately honoring those who lead the charge in sustainable transit solutions.</p>
</section>
<section id="most-emissions-avoiders" class="level2">
<h2 class="anchored" data-anchor-id="most-emissions-avoiders">Most Emissions Avoiders</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Running_away.jpg" class="img-fluid figure-img"></p>
<figcaption>Keep Running!</figcaption>
</figure>
</div>
<p>This award goes to the agency that has dodged more emissions than a cat avoids a bath. It doesn’t matter whether you’re a small-town hero or a big-city giant—what matters is the monumental strides each agency makes in avoiding emissions. In a world where we’re all searching for alternatives to car congestion and the endless honking, these agencies have carved out greener, faster routes to ease the burden on our communities. Their efforts not only improve our quality of life but also prove that fighting pollution can be as exhilarating as outrunning rush hour traffic. Congratulations to those who make our air cleaner and our commutes a little less chaotic!</p>
<p><strong>Small-Sized Transit Agency:</strong> <br> Agency - Hampton Jitney, Inc <br> State - New York <br> Total Miles Accrued - 49,533,110 <br> Lbs of CO2 avoided - 28,931,084 <br></p>
<p><strong>Medium-sized Transit Agency:</strong> <br> Agency - Hudson Transit Lines, Inc., dba: Short Line <br> State - New Jersey <br> Total Miles Accrued - 93,151,932 <br> Lbs of CO2 avoided - 51,369,438 <br></p>
<p><strong>Large-sized Transit Agency</strong> <br> Agency - MTA New York City Transit <br> State - New York <br> Total Miles Accrued - 47,956,268,290 <br> Lbs of CO2 avoided - 29,455,493,069 <br></p>
<p>We computed the emissions avoided by each agency using a straightforward set of steps. First, we summed each agency’s total miles traveled and estimated their actual transit emissions based on a per-mile factor. Then, using US CAFE standards, we converted the miles into gallons—assuming an average of 25 miles per gallon—and calculated the hypothetical emissions if those miles were driven in an individual vehicle (with 19.6 lbs CO₂ per gallon). Finally, by subtracting the actual transit emissions from the hypothetical driving emissions, we arrived at the emissions avoided. This metric not only highlights the environmental impact of each agency’s operations but also underscores the significant strides made in reducing our carbon footprint through smart transit choices.</p>
</section>
<section id="the-smooth-sailors" class="level2">
<h2 class="anchored" data-anchor-id="the-smooth-sailors">The Smooth Sailors</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="happy.jpg" class="img-fluid figure-img"></p>
<figcaption>Rolling it in!</figcaption>
</figure>
</div>
<p>You know we love being green here! Renewable energy is as good as it can get, and we here are excited to present this award to the ones who use electricity the most. In a world where innovation meets sustainability, our award celebrates those transit agencies that spark change and set a high-voltage example for eco-friendly transportation. By harnessing the power of clean energy, these pioneers not only reduce carbon footprints but also lead the charge toward a more sustainable future. Their commitment to electrification is a testament to the potential of modern technology to transform everyday travel into a greener, more efficient experience. With high-speed trains buzzing on electric tracks, they’re powering progress one mile at a time. Congratulations to all the electrifying contenders—keep the current flowing!</p>
<p><strong>Small-Sized Transit Agency:</strong> <br> Agency - Pennsylvania Department of Transportation <br> State - Pennsylvania <br> Percent Electric: 100% <br> Total Miles: 33,974,346 <br></p>
<p><strong>Medium-sized Transit Agency:</strong> <br> Agency - Northern Indiana Commuter Transportation District, dba: South Shore Line <br> State - Indiana <br> Percent Electric: 100% <br> Total Miles: 49,941,941 <br></p>
<p><strong>Large-sized Transit Agency</strong> <br> Agency - Port Authority Trans-Hudson Corporation <br> State - New York <br> Percent Electric: 100% <br> Total Miles: 268,404,831 <br></p>
<p>Our methodology was straightforward yet robust. We calculated the award score by dividing the total electricity used—comprising both battery and propulsion energy—by the total fuel sources consumed, ranging from diesel to battery power. This calculation provided us with a “percent electric score,” a clear indicator of how electric-powered a transit agency’s operations are.</p>
<p>We recognize that several agencies achieve a 100% carbon-neutral status by relying entirely on electric power. However, to add an extra layer of competitive rigor, we also considered travel mileage. For each category—small, medium, and large agencies—we selected the contenders that not only excel in electrification but also travel the most miles. This dual criterion ensures that our award honors those transit agencies that not only commit to sustainability but also demonstrate exceptional operational efficiency and impact.</p>
</section>
<section id="the-earth-destroyers" class="level2">
<h2 class="anchored" data-anchor-id="the-earth-destroyers">The Earth Destroyers</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="disgusted.jpg" class="img-fluid figure-img"></p>
<figcaption>Yea you…</figcaption>
</figure>
</div>
<p>This list might be naughtier than Santa’s, and we are definetely checking this twice. The Earth Destroyer award is the least sought after the attendees today, and the most exciting one for us here at the Green Transit Alliance. This distinction is not a celebration but rather a candid wake-up call for agencies that remain heavily reliant on diesel—the fuel source responsible for significant CO₂ emissions.</p>
<p><strong>Small-Sized Transit Agency:</strong> <br> Agency - Seastreak LLC <br> State - New Jersey <br> Earth-Destroying Ratio - 2.48 gallons of diesel per UPT trip <br></p>
<p><strong>Medium-sized Transit Agency:</strong> <br> Agency - Virginia Railway Express <br> State - Virginia <br> Earth-Destroying Ratio - 2.48 gallons of diesel per UPT trip <br></p>
<p><strong>Large-sized Transit Agency</strong> <br> Agency - Washington State Ferries <br> State - Washington <br> Earth-Destroying Ratio - 2.48 gallons of diesel per UPT trip <br></p>
<p>This award was calculated by taking diesel, which is the highest CO₂ emitting energy source, and divided it by UPT, a measure of trips taken by passengers across the nation. Take this as a measure to stride towards, and to continously improve on.</p>
</section>
<section id="conclusion-of-the-awards" class="level2">
<h2 class="anchored" data-anchor-id="conclusion-of-the-awards">Conclusion of the awards</h2>
<p>And so, as we wrap up tonight’s celebration of high-octane eco-heroics, let’s give a standing (and maybe slightly electrified) ovation to our trailblazing transit agencies. Whether you’ve been zipping past emissions like a cat in a bathtub or powering the future one electric mile at a time, you’ve shown that fighting pollution can be as fun as outrunning rush hour—and almost as shocking as a surprise electric bill. Thank you for making our air cleaner, our commutes smoother, and our future a lot brighter. Keep dodging, keep rolling, and may your journeys always be greener than your punchlines!</p>
</section>
</section>
<section id="analysis" class="level1">
<h1>Analysis</h1>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>ensure_package <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(stringr)  <span class="co"># Make sure stringr is loaded</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(dplyr)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(httr2)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(rvest)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(datasets)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(purrr)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(DT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ensure_package <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    pkg <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">substitute</span>(pkg))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">options</span>(<span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN =</span> <span class="st">"https://cloud.r-project.org"</span>))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(pkg)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">require</span>(pkg, <span class="at">character.only=</span><span class="cn">TRUE</span>))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(dplyr)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(httr2)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(rvest)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(datasets)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(purrr)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(DT)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>get_eia_sep <span class="ot">&lt;-</span> <span class="cf">function</span>(state, abbr){</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    state_formatted <span class="ot">&lt;-</span> <span class="fu">str_to_lower</span>(state) <span class="sc">|&gt;</span> <span class="fu">str_replace_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>, <span class="st">""</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    dir_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    file_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_name, state_formatted)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(dir_name, <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(file_name)){</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        BASE_URL <span class="ot">&lt;-</span> <span class="st">"https://www.eia.gov"</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        REQUEST <span class="ot">&lt;-</span> <span class="fu">request</span>(BASE_URL) <span class="sc">|&gt;</span> </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>            <span class="fu">req_url_path</span>(<span class="st">"electricity"</span>, <span class="st">"state"</span>, state_formatted)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        RESPONSE <span class="ot">&lt;-</span> <span class="fu">req_perform</span>(REQUEST)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">resp_check_status</span>(RESPONSE)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">writeLines</span>(<span class="fu">resp_body_string</span>(RESPONSE), file_name)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    TABLE <span class="ot">&lt;-</span> <span class="fu">read_html</span>(file_name) <span class="sc">|&gt;</span> </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>        <span class="fu">html_element</span>(<span class="st">"table"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">html_table</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">Item =</span> <span class="fu">str_to_lower</span>(Item))</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">"U.S. rank"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(TABLE)){</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        TABLE <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">Rank =</span> <span class="st">`</span><span class="at">U.S. rank</span><span class="st">`</span>)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    CO2_MWh <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span> </span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Item <span class="sc">==</span> <span class="st">"carbon dioxide (lbs/mwh)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(Value) <span class="sc">|&gt;</span> </span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_replace_all</span>(<span class="st">","</span>, <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.numeric</span>()</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    PRIMARY <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span> </span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Item <span class="sc">==</span> <span class="st">"primary energy source"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(Rank)</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    RATE <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Item <span class="sc">==</span> <span class="st">"average retail price (cents/kwh)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(Value) <span class="sc">|&gt;</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.numeric</span>()</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    GENERATION_MWh <span class="ot">&lt;-</span> TABLE <span class="sc">|&gt;</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Item <span class="sc">==</span> <span class="st">"net generation (megawatthours)"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(Value) <span class="sc">|&gt;</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_replace_all</span>(<span class="st">","</span>, <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.numeric</span>()</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">CO2_MWh               =</span> CO2_MWh, </span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>               <span class="at">primary_source        =</span> PRIMARY,</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>               <span class="at">electricity_price_MWh =</span> RATE <span class="sc">*</span> <span class="dv">10</span>, <span class="co"># / 100 cents to dollars &amp;</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>               <span class="co"># * 1000 kWh to MWH </span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>               <span class="at">generation_MWh        =</span> GENERATION_MWh, </span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>               <span class="at">state                 =</span> state, </span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>               <span class="at">abbreviation          =</span> abbr</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>EIA_SEP_REPORT <span class="ot">&lt;-</span> <span class="fu">map2</span>(state.name, state.abb, get_eia_sep) <span class="sc">|&gt;</span> <span class="fu">list_rbind</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(scales)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(DT)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>EIA_SEP_REPORT <span class="sc">|&gt;</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>abbreviation) <span class="sc">|&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(CO2_MWh)) <span class="sc">|&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CO2_MWh =</span> <span class="fu">number</span>(CO2_MWh, <span class="at">big.mark=</span><span class="st">","</span>), </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">electricity_price_MWh =</span> <span class="fu">dollar</span>(electricity_price_MWh), </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">generation_MWh =</span> <span class="fu">number</span>(generation_MWh, <span class="at">big.mark=</span><span class="st">","</span>)) <span class="sc">|&gt;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">`</span><span class="at">Pounds of CO2 Emitted per MWh of Electricity Produced</span><span class="st">`</span><span class="ot">=</span>CO2_MWh, </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Primary Source of Electricity Generation</span><span class="st">`</span><span class="ot">=</span>primary_source, </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Average Retail Price for 1000 kWh</span><span class="st">`</span><span class="ot">=</span>electricity_price_MWh, </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Total Generation Capacity (MWh)</span><span class="st">`</span><span class="ot">=</span> generation_MWh, </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">State=</span>state) <span class="sc">|&gt;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-303c4c2f5e36de69356f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-303c4c2f5e36de69356f">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50"],["1,925","1,864","1,741","1,514","1,497","1,444","1,414","1,354","1,180","1,148","1,127","1,103","1,095","1,054","1,044","987","966","923","912","855","847","817","801","794","775","763","759","733","727","715","684","655","654","648","639","594","576","558","558","522","522","518","440","428","370","369","344","292","269","8"],["Coal","Coal","Coal","Coal","Coal","Petroleum","Coal","Coal","Natural gas","Natural gas","Coal","Coal","Natural gas","Coal","Natural gas","Natural gas","Natural gas","Natural gas","Natural gas","Natural gas","Natural gas","Natural gas","Wind","Natural gas","Wind","Wind","Wind","Natural gas","Natural gas","Nuclear","Natural gas","Natural gas","Natural gas","Natural gas","Natural gas","Natural gas","Natural gas","Natural gas","Nuclear","Nuclear","Natural gas","Natural gas","Natural gas","Natural gas","Hydroelectric","Wind","Hydroelectric","Hydroelectric","Nuclear","Hydroelectric"],["$102.60","$83.90","$99.60","$108.70","$114.90","$386.00","$80.30","$90.30","$214.10","$127.20","$109.70","$91.40","$128.50","$117.60","$110.40","$97.30","$89.10","$232.10","$136.80","$100.40","$216.20","$109.50","$122.10","$135.30","$94.20","$108.00","$94.70","$110.60","$114.70","$106.90","$121.90","$125.70","$130.90","$93.00","$106.10","$106.80","$242.40","$143.40","$105.00","$117.50","$182.80","$152.70","$248.70","$208.40","$90.80","$104.90","$103.20","$95.80","$229.60","$175.30"],["52,286,784","43,181,420","63,217,080","66,703,285","90,046,880","9,194,164","42,068,807","33,496,554","6,717,825","62,548,705","26,895,758","39,445,955","4,772,059","57,541,720","133,223,464","63,195,647","97,784,565","19,695,884","120,656,625","547,294,552","10,430,846","72,933,440","57,276,862","259,798,479","69,836,973","58,456,598","39,269,073","129,221,513","139,435,010","77,791,204","111,838,736","235,924,937","42,164,375","89,236,024","126,553,394","91,059,344","40,666,418","36,000,650","100,853,387","177,737,641","124,039,988","64,228,924","216,628,794","12,512,181","17,842,446","17,436,158","61,691,869","102,960,605","16,824,999","2,480,199"],["West Virginia","Wyoming","Kentucky","Missouri","Indiana","Hawaii","North Dakota","Utah","Alaska","Wisconsin","Montana","Nebraska","Delaware","Colorado","Ohio","Arkansas","Louisiana","Massachusetts","Michigan","Texas","Rhode Island","Mississippi","Minnesota","Florida","Iowa","Kansas","New Mexico","Georgia","Alabama","Tennessee","Arizona","Pennsylvania","Nevada","Oklahoma","North Carolina","Virginia","Connecticut","Maryland","South Carolina","Illinois","New York","New Jersey","California","Maine","Idaho","South Dakota","Oregon","Washington","New Hampshire","Vermont"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Pounds of CO2 Emitted per MWh of Electricity Produced<\/th>\n      <th>Primary Source of Electricity Generation<\/th>\n      <th>Average Retail Price for 1000 kWh<\/th>\n      <th>Total Generation Capacity (MWh)<\/th>\n      <th>State<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Pounds of CO2 Emitted per MWh of Electricity Produced","targets":1},{"name":"Primary Source of Electricity Generation","targets":2},{"name":"Average Retail Price for 1000 kWh","targets":3},{"name":"Total Generation Capacity (MWh)","targets":4},{"name":"State","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<section id="which-state-has-the-most-expensive-retail-electricity" class="level4">
<h4 class="anchored" data-anchor-id="which-state-has-the-most-expensive-retail-electricity">Which state has the most expensive retail electricity?</h4>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>most_expensive_retail_electricity <span class="ot">&lt;-</span> EIA_SEP_REPORT <span class="sc">|&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(electricity_price_MWh)) <span class="sc">|&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">electricity_price_MWh =</span> <span class="fu">dollar</span>(electricity_price_MWh))<span class="sc">|&gt;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">'State'</span> <span class="ot">=</span> state, <span class="st">`</span><span class="at">Average Retail Price for 1000 kWh</span><span class="st">`</span><span class="ot">=</span>electricity_price_MWh, <span class="st">'Primary Source of Electricity Generation'</span><span class="ot">=</span>primary_source)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(most_expensive_retail_electricity, <span class="at">caption =</span> <span class="st">"State With Most Expensive Retail Electricity"</span>, <span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>State With Most Expensive Retail Electricity</caption>
<colgroup>
<col style="width: 9%">
<col style="width: 41%">
<col style="width: 49%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">State</th>
<th style="text-align: center;">Average Retail Price for 1000 kWh</th>
<th style="text-align: center;">Primary Source of Electricity Generation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Hawaii</td>
<td style="text-align: center;">$386</td>
<td style="text-align: center;">Petroleum</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="which-state-has-the-dirtiest-electricity-mix" class="level4">
<h4 class="anchored" data-anchor-id="which-state-has-the-dirtiest-electricity-mix">Which state has the ’dirtiest electricity mix?</h4>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dirtiest_electricity_mix <span class="ot">&lt;-</span> EIA_SEP_REPORT <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(CO2_MWh)) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CO2_MWh =</span> <span class="fu">comma</span>(CO2_MWh)) <span class="sc">|&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">'State'</span> <span class="ot">=</span> state, <span class="st">`</span><span class="at">Pounds of CO2 Emitted per MWh of Electricity Produced</span><span class="st">`</span><span class="ot">=</span>CO2_MWh, <span class="st">`</span><span class="at">Primary Source of Electricity Generation</span><span class="st">`</span><span class="ot">=</span> primary_source)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(dirtiest_electricity_mix, <span class="at">caption =</span> <span class="st">"State With The Most CO2 emitted"</span>, <span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>State With The Most CO2 emitted</caption>
<colgroup>
<col style="width: 13%">
<col style="width: 49%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">State</th>
<th style="text-align: center;">Pounds of CO2 Emitted per MWh of Electricity Produced</th>
<th style="text-align: center;">Primary Source of Electricity Generation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">West Virginia</td>
<td style="text-align: center;">1,925</td>
<td style="text-align: center;">Coal</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="on-average-how-many-pounds-of-co2-are-emitted-per-mwh-of-electricity-produced-in-the-us-note-that-you-will-need-to-use-a-suitably-weighted-average-here." class="level4">
<h4 class="anchored" data-anchor-id="on-average-how-many-pounds-of-co2-are-emitted-per-mwh-of-electricity-produced-in-the-us-note-that-you-will-need-to-use-a-suitably-weighted-average-here.">On average, how many pounds of CO2 are emitted per MWh of electricity produced in the US? (Note that you will need to use a suitably weighted average here.)</h4>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the weighted average and store the result in a tibble</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>result_table <span class="ot">&lt;-</span> EIA_SEP_REPORT <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">summarise</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Weighted Average Pounds of CO2 per MWh</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">sum</span>(CO2_MWh <span class="sc">*</span> generation_MWh) <span class="sc">/</span> <span class="fu">sum</span>(generation_MWh),<span class="dv">0</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">select</span>(<span class="st">`</span><span class="at">Weighted Average Pounds of CO2 per MWh</span><span class="st">`</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(result_table, </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">caption =</span> <span class="st">"Weighted Average of Pounds Emitted per MWh of Electricity Produced"</span>, </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Weighted Average of Pounds Emitted per MWh of Electricity Produced</caption>
<thead>
<tr class="header">
<th style="text-align: center;">Weighted Average Pounds of CO2 per MWh</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">805</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="what-is-the-rarest-primary-energy-source-in-the-us-what-is-the-associated-cost-of-electricity-and-where-is-it-used" class="level4">
<h4 class="anchored" data-anchor-id="what-is-the-rarest-primary-energy-source-in-the-us-what-is-the-associated-cost-of-electricity-and-where-is-it-used">What is the rarest primary energy source in the US? What is the associated cost of electricity and where is it used?</h4>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>rarest_primary_energy_US <span class="ot">&lt;-</span> EIA_SEP_REPORT <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(primary_source, <span class="at">name =</span> <span class="st">"Frequency"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Frequency) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(primary_source)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  EIA_SEP_REPORT <span class="sc">|&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(rarest_primary_energy_US, <span class="at">by =</span> <span class="st">"primary_source"</span>) <span class="sc">|&gt;</span> <span class="co">#primary source is our primary key I am joining dataframes by</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">`</span><span class="at">Primary Energy Source</span><span class="st">`</span> <span class="ot">=</span> primary_source, </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Average Retail Price for 1000 kWh</span><span class="st">`</span> <span class="ot">=</span> electricity_price_MWh,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>           <span class="st">'State'</span> <span class="ot">=</span> state) <span class="sc">|&gt;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Average Retail Price for 1000 kWh</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">dollar</span>(<span class="st">`</span><span class="at">Average Retail Price for 1000 kWh</span><span class="st">`</span>)),</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Rarest Primary Energy Source"</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"c"</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Rarest Primary Energy Source</caption>
<thead>
<tr class="header">
<th style="text-align: center;">Primary Energy Source</th>
<th style="text-align: center;">Average Retail Price for 1000 kWh</th>
<th style="text-align: center;">State</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Petroleum</td>
<td style="text-align: center;">$386</td>
<td style="text-align: center;">Hawaii</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="how-many-times-cleaner-is-nys-energy-mix-than-that-of-texas" class="level4">
<h4 class="anchored" data-anchor-id="how-many-times-cleaner-is-nys-energy-mix-than-that-of-texas">How many times cleaner is NY’s energy mix than that of Texas?</h4>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)  </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>emissions_NY_Texas <span class="ot">&lt;-</span> EIA_SEP_REPORT <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Texas"</span>, <span class="st">"New York"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">'State'</span> <span class="ot">=</span> state, <span class="st">`</span><span class="at">Pounds of CO2 Emitted per MWh of Electricity Produced</span><span class="st">`</span> <span class="ot">=</span> CO2_MWh) <span class="sc">|&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">deframe</span>() <span class="co">#I use deframe() without the need to create seperate variables for filtering out Texas &amp; New York</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># ratio</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>ny_times_cleaner <span class="ot">&lt;-</span> emissions_NY_Texas[<span class="st">"Texas"</span>] <span class="sc">/</span> emissions_NY_Texas[<span class="st">"New York"</span>]</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">tibble</span>(</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Pounds of CO2 Emitted per MWh of Electricity Produced by Texas</span><span class="st">`</span> <span class="ot">=</span> emissions_NY_Texas[<span class="st">"Texas"</span>],</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Pounds of CO2 Emitted per MWh of Electricity Produced by New York</span><span class="st">`</span> <span class="ot">=</span> emissions_NY_Texas[<span class="st">"New York"</span>],</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Times NY is Cleaner than Texas</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(ny_times_cleaner, <span class="dv">2</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>), <span class="at">caption =</span> <span class="st">"Comparison of CO₂ Emissions and Cleanliness Ratio"</span>, <span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Comparison of CO₂ Emissions and Cleanliness Ratio</caption>
<colgroup>
<col style="width: 39%">
<col style="width: 41%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Pounds of CO2 Emitted per MWh of Electricity Produced by Texas</th>
<th style="text-align: center;">Pounds of CO2 Emitted per MWh of Electricity Produced by New York</th>
<th style="text-align: center;">Times NY is Cleaner than Texas</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">855</td>
<td style="text-align: center;">522</td>
<td style="text-align: center;">1.64</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(readxl)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 'data/mp02' directory if not already present</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>DATA_DIR <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp02"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(DATA_DIR, <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY_FILE <span class="ot">&lt;-</span> <span class="fu">file.path</span>(DATA_DIR, <span class="st">"2023_ntd_energy.xlsx"</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(NTD_ENERGY_FILE)){</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    DS <span class="ot">&lt;-</span> <span class="fu">download.file</span>(<span class="st">"https://www.transit.dot.gov/sites/fta.dot.gov/files/2024-10/2023%20Energy%20Consumption.xlsx"</span>, </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">destfile=</span>NTD_ENERGY_FILE, </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method=</span><span class="st">"curl"</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(DS <span class="sc">|</span> (<span class="fu">file.info</span>(NTD_ENERGY_FILE)<span class="sc">$</span>size <span class="sc">==</span> <span class="dv">0</span>)){</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"I was unable to download the NTD Energy File. Please try again.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Download failed"</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY_RAW <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(NTD_ENERGY_FILE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ensure_package</span>(tidyr)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>to_numeric_fill_0 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">if_else</span>(x <span class="sc">==</span> <span class="st">"-"</span>, <span class="cn">NA</span>, x)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">replace_na</span>(<span class="fu">as.numeric</span>(x), <span class="dv">0</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY <span class="ot">&lt;-</span> NTD_ENERGY_RAW <span class="sc">|&gt;</span> </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Reporter Type</span><span class="st">`</span>, </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Reporting Module</span><span class="st">`</span>, </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Other Fuel</span><span class="st">`</span>, </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Other Fuel Description</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Agency Name</span><span class="st">`</span>, </span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>                     <span class="st">`</span><span class="at">Mode</span><span class="st">`</span>,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>                     <span class="st">`</span><span class="at">TOS</span><span class="st">`</span>), </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>                  to_numeric_fill_0)) <span class="sc">|&gt;</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="st">`</span><span class="at">NTD ID</span><span class="st">`</span>, <span class="st">`</span><span class="at">Mode</span><span class="st">`</span>, <span class="st">`</span><span class="at">Agency Name</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), sum), </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">.groups =</span> <span class="st">"keep"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ENERGY =</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(<span class="fu">c</span>(<span class="fu">where</span>(is.numeric))))) <span class="sc">|&gt;</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ENERGY <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>ENERGY) <span class="sc">|&gt;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Mode)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Recode the Mode column based on NTD interpretations</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY <span class="ot">&lt;-</span> NTD_ENERGY <span class="sc">|&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Mode =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"HR"</span> <span class="sc">~</span> <span class="st">"Heavy Rail"</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"DR"</span> <span class="sc">~</span> <span class="st">"Demand Response"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"FB"</span> <span class="sc">~</span> <span class="st">"Ferryboat"</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"MB"</span> <span class="sc">~</span> <span class="st">"Bus"</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"SR"</span> <span class="sc">~</span> <span class="st">"Streetcar Rail"</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"TB"</span> <span class="sc">~</span> <span class="st">"Trolleybus"</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"VP"</span> <span class="sc">~</span> <span class="st">"Vanpool"</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"CB"</span> <span class="sc">~</span> <span class="st">"Commuter Bus"</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"RB"</span> <span class="sc">~</span> <span class="st">"Bus Rapid Transit"</span>,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"LR"</span> <span class="sc">~</span> <span class="st">"Light Rail"</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"MG"</span> <span class="sc">~</span> <span class="st">"Monorail/Automated Guideway"</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"CR"</span> <span class="sc">~</span> <span class="st">"Commuter Rail"</span>,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"AR"</span> <span class="sc">~</span> <span class="st">"Alaska Railroad"</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"TR"</span> <span class="sc">~</span> <span class="st">"Aerial Tramway"</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"YR"</span> <span class="sc">~</span> <span class="st">"Hybrid Rail"</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"IR"</span> <span class="sc">~</span> <span class="st">"Inclined Plane"</span>,</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"PB"</span> <span class="sc">~</span> <span class="st">"Publico"</span>,</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    Mode <span class="sc">==</span> <span class="st">"CC"</span> <span class="sc">~</span> <span class="st">"Cable Car"</span>,</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Unknown"</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>NTD_ENERGY <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Mode) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 1
   Mode           
   &lt;chr&gt;          
 1 Demand Response
 2 Ferryboat      
 3 Bus            
 4 Streetcar Rail 
 5 Trolleybus     
 6 Vanpool        
 7 Demand Response
 8 Bus            
 9 Vanpool        
10 Demand Response</code></pre>
</div>
</div>
<p>https://www.transit.dot.gov/ntd/data-product/2023-fuel-and-energy</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE_FILE <span class="ot">&lt;-</span> <span class="fu">file.path</span>(DATA_DIR, <span class="st">"2023_service.csv"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(NTD_SERVICE_FILE)){</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    DS <span class="ot">&lt;-</span> <span class="fu">download.file</span>(<span class="st">"https://data.transportation.gov/resource/6y83-7vuw.csv"</span>, </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">destfile=</span>NTD_SERVICE_FILE, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">method=</span><span class="st">"curl"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(DS <span class="sc">|</span> (<span class="fu">file.info</span>(NTD_SERVICE_FILE)<span class="sc">$</span>size <span class="sc">==</span> <span class="dv">0</span>)){</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">"I was unable to download the NTD Service File. Please try again.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Download failed"</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE_RAW <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(NTD_SERVICE_FILE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE <span class="ot">&lt;-</span> NTD_SERVICE_RAW <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">NTD ID</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="st">`</span><span class="at">_5_digit_ntd_id</span><span class="st">`</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Agency =</span> agency, </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">City   =</span> max_city, </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">State  =</span> max_state,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">UPT    =</span> sum_unlinked_passenger_trips_upt, </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">MILES  =</span> sum_passenger_miles) <span class="sc">|&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">"^[A-Z]"</span>, <span class="at">ignore.case=</span><span class="cn">FALSE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(MILES <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="which-transit-service-has-the-most-upt-annually" class="level4">
<h4 class="anchored" data-anchor-id="which-transit-service-has-the-most-upt-annually">Which transit service has the most UPT annually?</h4>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(UPT)) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">UPT =</span> <span class="fu">comma</span>(UPT)) <span class="sc">|&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Agency, UPT) <span class="sc">|&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Transit Service With Most UPT In 2023"</span>, <span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Transit Service With Most UPT In 2023</caption>
<colgroup>
<col style="width: 82%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Agency</th>
<th style="text-align: center;">UPT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">MTA New York City Transit</td>
<td style="text-align: center;">2,632,003,044</td>
</tr>
<tr class="even">
<td style="text-align: center;">Chicago Transit Authority</td>
<td style="text-align: center;">279,146,501</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Massachusetts Bay Transportation Authority</td>
<td style="text-align: center;">234,975,556</td>
</tr>
<tr class="even">
<td style="text-align: center;">Washington Metropolitan Area Transit Authority, dba: Washington Metro</td>
<td style="text-align: center;">231,023,784</td>
</tr>
<tr class="odd">
<td style="text-align: center;">New Jersey Transit Corporation</td>
<td style="text-align: center;">198,590,133</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="what-is-the-average-trip-length-of-a-trip-on-mta-nyc" class="level4">
<h4 class="anchored" data-anchor-id="what-is-the-average-trip-length-of-a-trip-on-mta-nyc">What is the average trip length of a trip on MTA NYC?</h4>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Agency <span class="sc">==</span> <span class="st">"MTA New York City Transit"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">Average Trip</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(MILES <span class="sc">/</span> UPT, <span class="dv">1</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Average Commuter Trip Length (Miles)"</span>, <span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Average Commuter Trip Length (Miles)</caption>
<thead>
<tr class="header">
<th style="text-align: center;">Average Trip</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">3.6</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="which-transit-service-in-nyc-has-the-longest-average-trip-length" class="level4">
<h4 class="anchored" data-anchor-id="which-transit-service-in-nyc-has-the-longest-average-trip-length">Which transit service in NYC has the longest average trip length?</h4>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(City <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Brooklyn"</span>, <span class="st">"Bronx"</span>, <span class="st">"Queens"</span>, <span class="st">"Staten Island"</span>, <span class="st">"Manhattan"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Agency, City) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">Average Trip Length (miles)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(MILES <span class="sc">/</span> UPT, <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Average Trip Length (miles)</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Transit Services in NYC With The Longest Trip Lengths"</span>, <span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Transit Services in NYC With The Longest Trip Lengths</caption>
<colgroup>
<col style="width: 65%">
<col style="width: 11%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Agency</th>
<th style="text-align: center;">City</th>
<th style="text-align: center;">Average Trip Length (miles)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Staten Island Rapid Transit Operating Authority, dba: MTA Staten Island Railway</td>
<td style="text-align: center;">Staten Island</td>
<td style="text-align: center;">5.88</td>
</tr>
<tr class="even">
<td style="text-align: center;">Private Transportation Corporation</td>
<td style="text-align: center;">Brooklyn</td>
<td style="text-align: center;">5.23</td>
</tr>
<tr class="odd">
<td style="text-align: center;">MTA New York City Transit</td>
<td style="text-align: center;">Brooklyn</td>
<td style="text-align: center;">3.64</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="which-state-has-the-fewest-total-miles-travelled-by-public-transit" class="level4">
<h4 class="anchored" data-anchor-id="which-state-has-the-fewest-total-miles-travelled-by-public-transit">Which state has the fewest total miles travelled by public transit?</h4>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>NTD_SERVICE <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">State =</span> <span class="fu">recode</span>(State, <span class="st">"NH"</span> <span class="ot">=</span> <span class="st">"New Hampshire"</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"MS"</span> <span class="ot">=</span> <span class="st">"Mississippi"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"ID"</span> <span class="ot">=</span> <span class="st">"Idaho"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"VT"</span> <span class="ot">=</span> <span class="st">"Vermont"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"WV"</span> <span class="ot">=</span> <span class="st">"Wyoming"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(State) <span class="sc">|&gt;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">Total Miles Travelled</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(MILES)) <span class="sc">|&gt;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="st">`</span><span class="at">Total Miles Travelled</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Total Miles Travelled</span><span class="st">`</span> <span class="ot">=</span> scales<span class="sc">::</span><span class="fu">comma</span>(<span class="st">`</span><span class="at">Total Miles Travelled</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"States with the Fewest Total Miles Travelled by Public Transit"</span>, <span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>States with the Fewest Total Miles Travelled by Public Transit</caption>
<thead>
<tr class="header">
<th style="text-align: center;">State</th>
<th style="text-align: center;">Total Miles Travelled</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">New Hampshire</td>
<td style="text-align: center;">3,749,892</td>
</tr>
<tr class="even">
<td style="text-align: center;">Mississippi</td>
<td style="text-align: center;">8,040,472</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Idaho</td>
<td style="text-align: center;">9,555,549</td>
</tr>
<tr class="even">
<td style="text-align: center;">Vermont</td>
<td style="text-align: center;">10,319,587</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Wyoming</td>
<td style="text-align: center;">14,320,218</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="are-all-states-represented-in-this-data-if-no-which-ones-are-missing" class="level4">
<h4 class="anchored" data-anchor-id="are-all-states-represented-in-this-data-if-no-which-ones-are-missing">Are all states represented in this data? If no, which ones are missing?</h4>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">State =</span> state.name, <span class="at">Abbreviation =</span> state.abb) <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>Abbreviation <span class="sc">%in%</span> NTD_SERVICE<span class="sc">$</span>State) <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"States Missing from NTD_SERVICE"</span>, <span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>States Missing from NTD_SERVICE</caption>
<thead>
<tr class="header">
<th style="text-align: center;">State</th>
<th style="text-align: center;">Abbreviation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Arizona</td>
<td style="text-align: center;">AZ</td>
</tr>
<tr class="even">
<td style="text-align: center;">Arkansas</td>
<td style="text-align: center;">AR</td>
</tr>
<tr class="odd">
<td style="text-align: center;">California</td>
<td style="text-align: center;">CA</td>
</tr>
<tr class="even">
<td style="text-align: center;">Colorado</td>
<td style="text-align: center;">CO</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Hawaii</td>
<td style="text-align: center;">HI</td>
</tr>
<tr class="even">
<td style="text-align: center;">Iowa</td>
<td style="text-align: center;">IA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Kansas</td>
<td style="text-align: center;">KS</td>
</tr>
<tr class="even">
<td style="text-align: center;">Louisiana</td>
<td style="text-align: center;">LA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Missouri</td>
<td style="text-align: center;">MO</td>
</tr>
<tr class="even">
<td style="text-align: center;">Montana</td>
<td style="text-align: center;">MT</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Nebraska</td>
<td style="text-align: center;">NE</td>
</tr>
<tr class="even">
<td style="text-align: center;">Nevada</td>
<td style="text-align: center;">NV</td>
</tr>
<tr class="odd">
<td style="text-align: center;">New Mexico</td>
<td style="text-align: center;">NM</td>
</tr>
<tr class="even">
<td style="text-align: center;">North Dakota</td>
<td style="text-align: center;">ND</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Oklahoma</td>
<td style="text-align: center;">OK</td>
</tr>
<tr class="even">
<td style="text-align: center;">South Dakota</td>
<td style="text-align: center;">SD</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Texas</td>
<td style="text-align: center;">TX</td>
</tr>
<tr class="even">
<td style="text-align: center;">Utah</td>
<td style="text-align: center;">UT</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Wyoming</td>
<td style="text-align: center;">WY</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>agencies <span class="ot">&lt;-</span> </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    NTD_SERVICE,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    NTD_ENERGY <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">`</span><span class="at">Kerosene</span><span class="st">`</span>, <span class="st">`</span><span class="at">Bunker Fuel</span><span class="st">`</span>, <span class="st">`</span><span class="at">Ethanol</span><span class="st">`</span>, <span class="st">`</span><span class="at">Methonal</span><span class="st">`</span>)),</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"NTD ID"</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    EIA_SEP_REPORT,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"State"</span> <span class="ot">=</span> <span class="st">"abbreviation"</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Agency Name</span><span class="st">`</span>, <span class="sc">-</span>State) <span class="sc">|&gt;</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">agency              =</span> Agency,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">city                =</span> City,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode                =</span> Mode,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">upt                 =</span> UPT,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">miles               =</span> MILES,</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">ntd_id              =</span> <span class="st">`</span><span class="at">NTD ID</span><span class="st">`</span>,</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">biodiesel           =</span> <span class="st">`</span><span class="at">Bio-Diesel</span><span class="st">`</span>,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">cnaturalgas         =</span> <span class="st">`</span><span class="at">C Natural Gas</span><span class="st">`</span>,</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">diesel              =</span> <span class="st">`</span><span class="at">Diesel Fuel</span><span class="st">`</span>,</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">gasoline            =</span> Gasoline,</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">liqnatgas           =</span> <span class="st">`</span><span class="at">Liquified Nat Gas</span><span class="st">`</span>,</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">liqpetgas           =</span> <span class="st">`</span><span class="at">Liquified Petroleum Gas</span><span class="st">`</span>,</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">electric_battery    =</span> <span class="st">`</span><span class="at">Electric Battery</span><span class="st">`</span>,</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">electric_propulsion =</span> <span class="st">`</span><span class="at">Electric Propulsion</span><span class="st">`</span>,</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">co2_mwh             =</span> CO2_MWh</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>agencies <span class="ot">&lt;-</span> agencies <span class="sc">|&gt;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#these are pounds per gallon CO2 from the website</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_co2_emissions =</span> </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>      (biodiesel           <span class="sc">*</span> <span class="fl">24.78</span>) <span class="sc">+</span>  </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>      (cnaturalgas         <span class="sc">*</span> <span class="fl">13.83</span>) <span class="sc">+</span>  <span class="co">#divded cubic feet by 8.741</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>      (diesel              <span class="sc">*</span> <span class="fl">22.45</span>) <span class="sc">+</span> </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>      (gasoline            <span class="sc">*</span> <span class="fl">21.78</span>) <span class="sc">+</span>  </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>      (liqnatgas           <span class="sc">*</span> <span class="fl">13.83</span>) <span class="sc">+</span>  <span class="co">#divded cubic feet by 8.741</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>      (liqpetgas           <span class="sc">*</span> <span class="fl">12.68</span>) <span class="sc">+</span>  </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>      <span class="co"># For electric usage, you might multiply MWh by the state-specific CO2 factor:</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>      (electric_battery    <span class="sc">*</span> co2_mwh <span class="sc">/</span> <span class="dv">1000</span>) <span class="sc">+</span>  </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>      (electric_propulsion <span class="sc">*</span> co2_mwh <span class="sc">/</span> <span class="dv">1000</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="awards-calculations" class="level1">
<h1>Awards Calculations</h1>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define new thresholds based on UPT quartiles.</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>P25 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(agencies <span class="sc">|&gt;</span> <span class="fu">select</span>(upt) <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">pull</span>(upt), <span class="fl">0.25</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>P50 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(agencies  <span class="sc">|&gt;</span> <span class="fu">select</span>(upt) <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">pull</span>(upt), <span class="fl">0.50</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>P75 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(agencies  <span class="sc">|&gt;</span> <span class="fu">select</span>(upt) <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">pull</span>(upt), <span class="fl">0.75</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Mutating a new emissions per up and per mile columns</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>agencies  <span class="ot">&lt;-</span> agencies  <span class="sc">|&gt;</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ntd_id) <span class="sc">|&gt;</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">emissions_per_upt  =</span> <span class="fu">sum</span>(total_co2_emissions) <span class="sc">/</span> upt,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">emissions_per_mile =</span> <span class="fu">sum</span>(total_co2_emissions) <span class="sc">/</span> miles,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#we will use the harmonic mean. Particuarly useful as in this case emissions_pet_upt and emissions_per_mile are like ratios, and are still related to one another. Such as total co2 emissions per upt for every mile.</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">green_score =</span> <span class="fu">round</span>(<span class="dv">2</span> <span class="sc">*</span> (emissions_per_upt <span class="sc">*</span> emissions_per_mile) <span class="sc">/</span> (emissions_per_upt <span class="sc">+</span> emissions_per_mile), <span class="dv">2</span>),</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assign a size category based on UPT quartiles. I have an 'extra small' category but it won't be used for the awards</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fu">case_when</span>(</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>      upt <span class="sc">&lt;</span> P25 <span class="sc">~</span> <span class="st">"Extra Small"</span>,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>      upt <span class="sc">&gt;=</span> P25 <span class="sc">&amp;</span> upt <span class="sc">&lt;</span> P50 <span class="sc">~</span> <span class="st">"Small"</span>,</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>      upt <span class="sc">&gt;=</span> P50 <span class="sc">&amp;</span> upt <span class="sc">&lt;</span> P75 <span class="sc">~</span> <span class="st">"Medium"</span>,</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>      upt <span class="sc">&gt;=</span> P75 <span class="sc">~</span> <span class="st">"Large"</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="greenest-transit-agency-1" class="level3">
<h3 class="anchored" data-anchor-id="greenest-transit-agency-1">Greenest Transit Agency</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Greenest agency for Small agencies</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>greenest_small <span class="ot">&lt;-</span> agencies  <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(size <span class="sc">==</span> <span class="st">"Small"</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(green_score <span class="sc">==</span> <span class="fu">min</span>(green_score)) <span class="sc">|&gt;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(agency, state, city, miles, primary_source, emissions_per_mile, green_score, size)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Greenest agency for Medium agencies</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>greenest_medium <span class="ot">&lt;-</span> agencies  <span class="sc">|&gt;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(size <span class="sc">==</span> <span class="st">"Medium"</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(green_score <span class="sc">==</span> <span class="fu">min</span>(green_score)) <span class="sc">|&gt;</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(agency, state, city, miles, primary_source, emissions_per_mile, green_score, size)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Greenest agency for Large agencies</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>greenest_large <span class="ot">&lt;-</span> agencies  <span class="sc">|&gt;</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(size <span class="sc">==</span> <span class="st">"Large"</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(green_score <span class="sc">==</span> <span class="fu">min</span>(green_score)) <span class="sc">|&gt;</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(agency, state, city, miles, primary_source, emissions_per_mile, green_score, size)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(greenest_small, <span class="at">caption =</span> <span class="st">"Greenest Small Transit Agency"</span>, <span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Greenest Small Transit Agency</caption>
<colgroup>
<col style="width: 20%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 14%">
<col style="width: 18%">
<col style="width: 11%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">agency</th>
<th style="text-align: center;">state</th>
<th style="text-align: center;">city</th>
<th style="text-align: center;">miles</th>
<th style="text-align: center;">primary_source</th>
<th style="text-align: center;">emissions_per_mile</th>
<th style="text-align: center;">green_score</th>
<th style="text-align: center;">size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Hampton Jitney, Inc.</td>
<td style="text-align: center;">New York</td>
<td style="text-align: center;">Calverton</td>
<td style="text-align: center;">49533110</td>
<td style="text-align: center;">Natural gas</td>
<td style="text-align: center;">0.1999243</td>
<td style="text-align: center;">0.4</td>
<td style="text-align: center;">Small</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(greenest_medium, <span class="at">caption =</span> <span class="st">"Greenest Medium Transit Agency"</span>, <span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Greenest Medium Transit Agency</caption>
<colgroup>
<col style="width: 35%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 11%">
<col style="width: 14%">
<col style="width: 9%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">agency</th>
<th style="text-align: center;">state</th>
<th style="text-align: center;">city</th>
<th style="text-align: center;">miles</th>
<th style="text-align: center;">primary_source</th>
<th style="text-align: center;">emissions_per_mile</th>
<th style="text-align: center;">green_score</th>
<th style="text-align: center;">size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">City of Seattle, dba: Seattle Center Monorail</td>
<td style="text-align: center;">Washington</td>
<td style="text-align: center;">Seattle</td>
<td style="text-align: center;">1921479</td>
<td style="text-align: center;">Hydroelectric</td>
<td style="text-align: center;">0.0768396</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">Medium</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(greenest_large, <span class="at">caption =</span> <span class="st">"Greenest Large Transit Agency"</span>, <span class="at">align =</span> <span class="st">"c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Greenest Large Transit Agency</caption>
<colgroup>
<col style="width: 45%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">agency</th>
<th style="text-align: center;">state</th>
<th style="text-align: center;">city</th>
<th style="text-align: center;">miles</th>
<th style="text-align: center;">primary_source</th>
<th style="text-align: center;">emissions_per_mile</th>
<th style="text-align: center;">green_score</th>
<th style="text-align: center;">size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Tri-County Metropolitan Transportation District of Oregon, dba: TriMet</td>
<td style="text-align: center;">Oregon</td>
<td style="text-align: center;">Portland</td>
<td style="text-align: center;">231430380</td>
<td style="text-align: center;">Hydroelectric</td>
<td style="text-align: center;">0.1247651</td>
<td style="text-align: center;">0.2</td>
<td style="text-align: center;">Large</td>
</tr>
<tr class="even">
<td style="text-align: center;">Tri-County Metropolitan Transportation District of Oregon, dba: TriMet</td>
<td style="text-align: center;">Oregon</td>
<td style="text-align: center;">Portland</td>
<td style="text-align: center;">231430380</td>
<td style="text-align: center;">Hydroelectric</td>
<td style="text-align: center;">0.1247651</td>
<td style="text-align: center;">0.2</td>
<td style="text-align: center;">Large</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Tri-County Metropolitan Transportation District of Oregon, dba: TriMet</td>
<td style="text-align: center;">Oregon</td>
<td style="text-align: center;">Portland</td>
<td style="text-align: center;">231430380</td>
<td style="text-align: center;">Hydroelectric</td>
<td style="text-align: center;">0.1247651</td>
<td style="text-align: center;">0.2</td>
<td style="text-align: center;">Large</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>agencies  <span class="sc">|&gt;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(size <span class="sc">!=</span> <span class="st">"Extra Small"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> green_score, <span class="at">fill =</span> size)) <span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Green Scores by Agency"</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Green Score (Lower is Greener)"</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Density"</span>,</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Agency Size"</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This density plot represents the green scores that are distributed across the different Agency size’s. Regions on the plot with highest density indicate that agencies have higher scores. For example, large agencies have the most values centered around a greend score of ‘0.8’. However smaller agencies have higher green scores of all 3 agencies.</p>
</section>
<section id="most-emissions-avoiders-1" class="level3">
<h3 class="anchored" data-anchor-id="most-emissions-avoiders-1">Most Emissions Avoiders</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>mpg_value <span class="ot">&lt;-</span> <span class="dv">25</span>            <span class="co"># Average miles per gallon</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>fuel_emission_factor <span class="ot">&lt;-</span> <span class="fl">19.6</span>  <span class="co"># lbs CO₂ emitted per gallon</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize each agency's performance: total miles and actual transit emissions.</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># We assume actual transit emissions are approximated by: total_miles * emissions_per_mile.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>agency_emissions_summary <span class="ot">&lt;-</span> agencies  <span class="sc">|&gt;</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency, state, size) <span class="sc">|&gt;</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_miles =</span> <span class="fu">sum</span>(miles),</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">actual_transit_emissions =</span> <span class="fu">sum</span>(miles <span class="sc">*</span> emissions_per_mile)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert miles to gallons used based on average MPG</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">gallons_used =</span> total_miles <span class="sc">/</span> mpg_value,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Hypothetical emissions if each mile were driven in an individual vehicle</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">hypothetical_driving_emissions =</span> gallons_used <span class="sc">*</span> fuel_emission_factor,</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Emissions avoided by using transit instead of driving</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">avoided_emissions =</span> hypothetical_driving_emissions <span class="sc">-</span> actual_transit_emissions</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co"># For Small Agencies</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>emissions_avoided_small <span class="ot">&lt;-</span> agency_emissions_summary <span class="sc">|&gt;</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(size <span class="sc">==</span> <span class="st">"Small"</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avoided_emissions)) <span class="sc">|&gt;</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Format numeric columns with commas for Small Agencies</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>emissions_avoided_small_fmt <span class="ot">&lt;-</span> emissions_avoided_small <span class="sc">|&gt;</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_miles =</span> <span class="fu">comma</span>(total_miles),</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">actual_transit_emissions =</span> <span class="fu">comma</span>(actual_transit_emissions),</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">gallons_used =</span> <span class="fu">comma</span>(gallons_used),</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">hypothetical_driving_emissions =</span> <span class="fu">comma</span>(hypothetical_driving_emissions),</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">avoided_emissions =</span> <span class="fu">comma</span>(avoided_emissions)</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>  emissions_avoided_small_fmt,</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Most Emissions Avoided: Small Agencies"</span>,</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"c"</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Most Emissions Avoided: Small Agencies</caption>
<colgroup>
<col style="width: 15%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 9%">
<col style="width: 18%">
<col style="width: 9%">
<col style="width: 22%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">agency</th>
<th style="text-align: center;">state</th>
<th style="text-align: center;">size</th>
<th style="text-align: center;">total_miles</th>
<th style="text-align: center;">actual_transit_emissions</th>
<th style="text-align: center;">gallons_used</th>
<th style="text-align: center;">hypothetical_driving_emissions</th>
<th style="text-align: center;">avoided_emissions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Hampton Jitney, Inc.</td>
<td style="text-align: center;">New York</td>
<td style="text-align: center;">Small</td>
<td style="text-align: center;">49,533,110</td>
<td style="text-align: center;">9,902,875</td>
<td style="text-align: center;">1,981,324</td>
<td style="text-align: center;">38,833,958</td>
<td style="text-align: center;">28,931,084</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For Medium Agencies</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>emissions_avoided_medium <span class="ot">&lt;-</span> agency_emissions_summary <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(size <span class="sc">==</span> <span class="st">"Medium"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avoided_emissions)) <span class="sc">|&gt;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Format numeric columns with commas for Medium Agencies</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>emissions_avoided_medium_fmt <span class="ot">&lt;-</span> emissions_avoided_medium <span class="sc">|&gt;</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_miles =</span> <span class="fu">comma</span>(total_miles),</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">actual_transit_emissions =</span> <span class="fu">comma</span>(actual_transit_emissions),</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">gallons_used =</span> <span class="fu">comma</span>(gallons_used),</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">hypothetical_driving_emissions =</span> <span class="fu">comma</span>(hypothetical_driving_emissions),</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">avoided_emissions =</span> <span class="fu">comma</span>(avoided_emissions)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  emissions_avoided_medium_fmt,</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Most Emissions Avoided: Medium Agencies"</span>,</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"c"</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Most Emissions Avoided: Medium Agencies</caption>
<colgroup>
<col style="width: 26%">
<col style="width: 7%">
<col style="width: 4%">
<col style="width: 7%">
<col style="width: 15%">
<col style="width: 8%">
<col style="width: 18%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">agency</th>
<th style="text-align: center;">state</th>
<th style="text-align: center;">size</th>
<th style="text-align: center;">total_miles</th>
<th style="text-align: center;">actual_transit_emissions</th>
<th style="text-align: center;">gallons_used</th>
<th style="text-align: center;">hypothetical_driving_emissions</th>
<th style="text-align: center;">avoided_emissions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Hudson Transit Lines, Inc., dba: Short Line</td>
<td style="text-align: center;">New Jersey</td>
<td style="text-align: center;">Medium</td>
<td style="text-align: center;">93,151,932</td>
<td style="text-align: center;">21,721,677</td>
<td style="text-align: center;">3,726,077</td>
<td style="text-align: center;">73,031,115</td>
<td style="text-align: center;">51,309,438</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For Large Agencies</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>emissions_avoided_large <span class="ot">&lt;-</span> agency_emissions_summary <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(size <span class="sc">==</span> <span class="st">"Large"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avoided_emissions)) <span class="sc">|&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Format numeric columns with commas for Large Agencies</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>emissions_avoided_large_fmt <span class="ot">&lt;-</span> emissions_avoided_large <span class="sc">|&gt;</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_miles =</span> <span class="fu">comma</span>(total_miles),</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">actual_transit_emissions =</span> <span class="fu">comma</span>(actual_transit_emissions),</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">gallons_used =</span> <span class="fu">comma</span>(gallons_used),</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">hypothetical_driving_emissions =</span> <span class="fu">comma</span>(hypothetical_driving_emissions),</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">avoided_emissions =</span> <span class="fu">comma</span>(avoided_emissions)</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  emissions_avoided_large_fmt,</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Most Emissions Avoided: Large Agencies"</span>,</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"c"</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Most Emissions Avoided: Large Agencies</caption>
<colgroup>
<col style="width: 17%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 10%">
<col style="width: 17%">
<col style="width: 9%">
<col style="width: 21%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">agency</th>
<th style="text-align: center;">state</th>
<th style="text-align: center;">size</th>
<th style="text-align: center;">total_miles</th>
<th style="text-align: center;">actual_transit_emissions</th>
<th style="text-align: center;">gallons_used</th>
<th style="text-align: center;">hypothetical_driving_emissions</th>
<th style="text-align: center;">avoided_emissions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">MTA New York City Transit</td>
<td style="text-align: center;">New York</td>
<td style="text-align: center;">Large</td>
<td style="text-align: center;">47,956,268,290</td>
<td style="text-align: center;">8,142,221,270</td>
<td style="text-align: center;">1,918,250,732</td>
<td style="text-align: center;">37,597,714,339</td>
<td style="text-align: center;">29,455,493,069</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="the-smooth-sailors-1" class="level3">
<h3 class="anchored" data-anchor-id="the-smooth-sailors-1">The Smooth Sailors</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We are going to compute the electification award</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide electric by all fuel sources</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize electrification metrics for each agency (including state) and total miles.</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>agency_electrification <span class="ot">&lt;-</span> agencies  <span class="sc">|&gt;</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency, state, size) <span class="sc">|&gt;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_electric =</span> <span class="fu">sum</span>(electric_battery) <span class="sc">+</span> <span class="fu">sum</span>(electric_propulsion),</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_fuel =</span> <span class="fu">sum</span>(biodiesel) <span class="sc">+</span> <span class="fu">sum</span>(cnaturalgas) <span class="sc">+</span> <span class="fu">sum</span>(diesel) <span class="sc">+</span> <span class="fu">sum</span>(gasoline) <span class="sc">+</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">sum</span>(liqnatgas) <span class="sc">+</span> <span class="fu">sum</span>(liqpetgas) <span class="sc">+</span> <span class="fu">sum</span>(electric_battery) <span class="sc">+</span> <span class="fu">sum</span>(electric_propulsion),</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_miles =</span> <span class="fu">sum</span>(miles)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_electric =</span> (total_electric <span class="sc">/</span> total_fuel) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co"># For Small Agencies: sort by pct_electric and total_miles, then take the top one.</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>electrified_small <span class="ot">&lt;-</span> agency_electrification <span class="sc">|&gt;</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(size <span class="sc">==</span> <span class="st">"Small"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(pct_electric), <span class="fu">desc</span>(total_miles)) <span class="sc">|&gt;</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  electrified_small,</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Agency with Highest Electrification – Small Agencies"</span>,</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"c"</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Agency with Highest Electrification – Small Agencies</caption>
<colgroup>
<col style="width: 36%">
<col style="width: 11%">
<col style="width: 5%">
<col style="width: 13%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">agency</th>
<th style="text-align: center;">state</th>
<th style="text-align: center;">size</th>
<th style="text-align: center;">total_electric</th>
<th style="text-align: center;">total_fuel</th>
<th style="text-align: center;">total_miles</th>
<th style="text-align: center;">pct_electric</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Pennsylvania Department of Transportation</td>
<td style="text-align: center;">Pennsylvania</td>
<td style="text-align: center;">Small</td>
<td style="text-align: center;">14204836</td>
<td style="text-align: center;">14204836</td>
<td style="text-align: center;">33974346</td>
<td style="text-align: center;">100</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For Medium Agencies</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>electrified_medium <span class="ot">&lt;-</span> agency_electrification <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(size <span class="sc">==</span> <span class="st">"Medium"</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(pct_electric), <span class="fu">desc</span>(total_miles)) <span class="sc">|&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  electrified_medium,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Agency with Highest Electrification – Medium Agencies"</span>,</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"c"</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Agency with Highest Electrification – Medium Agencies</caption>
<colgroup>
<col style="width: 50%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">agency</th>
<th style="text-align: center;">state</th>
<th style="text-align: center;">size</th>
<th style="text-align: center;">total_electric</th>
<th style="text-align: center;">total_fuel</th>
<th style="text-align: center;">total_miles</th>
<th style="text-align: center;">pct_electric</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Northern Indiana Commuter Transportation District, dba: South Shore Line</td>
<td style="text-align: center;">Indiana</td>
<td style="text-align: center;">Medium</td>
<td style="text-align: center;">11106350</td>
<td style="text-align: center;">11106350</td>
<td style="text-align: center;">49941941</td>
<td style="text-align: center;">100</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For Large Agencies</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>electrified_large <span class="ot">&lt;-</span> agency_electrification <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(size <span class="sc">==</span> <span class="st">"Large"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(pct_electric), <span class="fu">desc</span>(total_miles)) <span class="sc">|&gt;</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  electrified_large,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Agency with Highest Electrification – Large Agencies"</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"c"</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Agency with Highest Electrification – Large Agencies</caption>
<colgroup>
<col style="width: 36%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 14%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">agency</th>
<th style="text-align: center;">state</th>
<th style="text-align: center;">size</th>
<th style="text-align: center;">total_electric</th>
<th style="text-align: center;">total_fuel</th>
<th style="text-align: center;">total_miles</th>
<th style="text-align: center;">pct_electric</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Port Authority Trans-Hudson Corporation</td>
<td style="text-align: center;">New York</td>
<td style="text-align: center;">Large</td>
<td style="text-align: center;">98060829</td>
<td style="text-align: center;">98060829</td>
<td style="text-align: center;">268404831</td>
<td style="text-align: center;">100</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="the-earth-destroyers-1" class="level3">
<h3 class="anchored" data-anchor-id="the-earth-destroyers-1">The Earth Destroyers</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize diesel usage and UPT</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>agency_dirtiness <span class="ot">&lt;-</span> agencies  <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency, state, size) <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_diesel =</span> <span class="fu">sum</span>(diesel),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_upt =</span> <span class="fu">sum</span>(upt)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dirtiness score: higher means more diesel usage per UPT.</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">dirtiness =</span> total_diesel <span class="sc">/</span> total_upt</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Small Agencies</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>dirtiest_small <span class="ot">&lt;-</span> agency_dirtiness <span class="sc">|&gt;</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(size <span class="sc">==</span> <span class="st">"Small"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dirtiness)) <span class="sc">|&gt;</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  dirtiest_small,</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Dirtiest Transit Agency: Small Agencies"</span>,</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"c"</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Dirtiest Transit Agency: Small Agencies</caption>
<colgroup>
<col style="width: 22%">
<col style="width: 16%">
<col style="width: 9%">
<col style="width: 19%">
<col style="width: 15%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">agency</th>
<th style="text-align: center;">state</th>
<th style="text-align: center;">size</th>
<th style="text-align: center;">total_diesel</th>
<th style="text-align: center;">total_upt</th>
<th style="text-align: center;">dirtiness</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">SeaStreak, LLC</td>
<td style="text-align: center;">New Jersey</td>
<td style="text-align: center;">Small</td>
<td style="text-align: center;">2956636</td>
<td style="text-align: center;">1192351</td>
<td style="text-align: center;">2.479669</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Medium Agencies</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>dirtiest_medium <span class="ot">&lt;-</span> agency_dirtiness <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(size <span class="sc">==</span> <span class="st">"Medium"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dirtiness)) <span class="sc">|&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  dirtiest_medium,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Dirtiest Transit Agency: Medium Agencies"</span>,</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"c"</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Dirtiest Transit Agency: Medium Agencies</caption>
<colgroup>
<col style="width: 32%">
<col style="width: 12%">
<col style="width: 10%">
<col style="width: 17%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">agency</th>
<th style="text-align: center;">state</th>
<th style="text-align: center;">size</th>
<th style="text-align: center;">total_diesel</th>
<th style="text-align: center;">total_upt</th>
<th style="text-align: center;">dirtiness</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Virginia Railway Express</td>
<td style="text-align: center;">Virginia</td>
<td style="text-align: center;">Medium</td>
<td style="text-align: center;">1665975</td>
<td style="text-align: center;">1466250</td>
<td style="text-align: center;">1.136215</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Large Agencies</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>dirtiest_large <span class="ot">&lt;-</span> agency_dirtiness <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(size <span class="sc">==</span> <span class="st">"Large"</span>) <span class="sc">|&gt;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(dirtiness)) <span class="sc">|&gt;</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  dirtiest_large,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Dirtiest Transit Agency: Large Agencies"</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">align =</span> <span class="st">"c"</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Dirtiest Transit Agency: Large Agencies</caption>
<colgroup>
<col style="width: 32%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 17%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">agency</th>
<th style="text-align: center;">state</th>
<th style="text-align: center;">size</th>
<th style="text-align: center;">total_diesel</th>
<th style="text-align: center;">total_upt</th>
<th style="text-align: center;">dirtiness</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Washington State Ferries</td>
<td style="text-align: center;">Washington</td>
<td style="text-align: center;">Large</td>
<td style="text-align: center;">14012522</td>
<td style="text-align: center;">18241119</td>
<td style="text-align: center;">0.7681832</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the dirtiest agencies from small-large into one df</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>top_dirtiest <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  dirtiest_small,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  dirtiest_medium,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  dirtiest_large</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top_dirtiest, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(agency, dirtiness), <span class="at">y =</span> dirtiness, <span class="at">fill =</span> size)) <span class="sc">+</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> size, <span class="at">scales =</span> <span class="st">"free_x"</span>) <span class="sc">+</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Dirtiest Transit Agencies by Size Category"</span>,</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Agency"</span>,</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Dirtiness Score (Diesel per UPT)"</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp02_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="sources" class="level4">
<h4 class="anchored" data-anchor-id="sources">Sources</h4>
<p>U.S. Energy Information Administration - EIA - Independent Statistics and Analysis. (n.d.). <a href="https://www.eia.gov/environment/emissions/co2_vol_mass.php">https://www.eia.gov/environment/emissions/co2_vol_mass.php</a></p>
<p>USDOT announces new vehicle fuel economy standards for model year 2024-2026. (2022, April 1). NHTSA. <a href="https://www.nhtsa.gov/press-releases/usdot-announces-new-vehicle-fuel-economy-standards-model-year-2024-2026">https://www.nhtsa.gov/press-releases/usdot-announces-new-vehicle-fuel-economy-standards-model-year-2024-2026</a></p>
<p>Greenhouse Gas Emissions from a Typical Passenger Vehicle | US EPA. (2024, August 23). US EPA. <a href="https://www.epa.gov/greenvehicles/greenhouse-gas-emissions-typical-passenger-vehicle#:~:text=Visit%20fueleconomy.gov%20for%20more,of%20CO2%20per%20mile">https://www.epa.gov/greenvehicles/greenhouse-gas-emissions-typical-passenger-vehicle#:~:text=Visit%20fueleconomy.gov%20for%20more,of%20CO2%20per%20mile</a></p>
<p>Smoothed density estimates — geom_density. (n.d.). <a href="https://ggplot2.tidyverse.org/reference/geom_density.html">https://ggplot2.tidyverse.org/reference/geom_density.html</a></p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/<Sal-Davi>\.github\.io\/STA9750-2025-SPRING\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>